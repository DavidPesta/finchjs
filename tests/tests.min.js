(function(){var e,o,a,n;o=function(e,o){return QUnit.push(e.calledOnce,e.callCount,1,o)},n=function(e,o){return QUnit.push(!e.called,e.callCount,0,o)},a=function(e,o,a){var n,t,l;return t=null!=e.lastCall&&QUnit.equiv(e.lastCall.args,o),n=null!=(l=e.lastCall)?l.args:void 0,QUnit.push(t,n,o,a)},e=function(){var e;return e={},e.reset=function(){var o,a,n;n=[];for(o in e)a=e[o],"[object Function]"===Object.prototype.toString.call(a.reset)?n.push(a.reset()):n.push(void 0);return n},e},module("Finch",{teardown:function(){return Finch.reset()}}),test("Trivial routing",sinon.test(function(){var e,a;return Finch.route("foo/bar",a=this.stub()),Finch.route("baz/quux",e=this.stub()),Finch.call("/foo/bar"),o(a,"foo/bar called"),Finch.call("/baz/quux"),o(e,"baz/quux called")})),test("Simple hierarchical routing",sinon.test(function(){var e,t,l,r,d,c,s;return Finch.route("foo",e=this.stub()),Finch.route("[foo]/bar",t=this.stub()),Finch.route("[foo/bar]/:id",l=this.stub()),Finch.route("[foo]/baz",r=this.stub()),Finch.route("[foo/baz]/:id",d=this.stub()),Finch.route("quux",c=this.stub()),Finch.route("[quux]/:id",s=this.stub()),Finch.call("/foo/bar"),o(e,"foo called once"),a(e,[{}],"foo called with correct bindings"),o(t,"foo/bar called once"),a(t,[{}],"foo called with correct bindings"),ok(e.calledBefore(t),"foo called before foo/bar"),e.reset(),t.reset(),Finch.call("/foo/bar/123"),n(e,"foo not called again"),n(t,"foo/bar not called again"),o(l,"foo/bar/id called once"),a(l,[{id:"123"}],"foo/bar/id bindings"),l.reset(),Finch.call("/foo/bar/123"),n(e,"foo not called again"),n(t,"foo/bar not called again"),n(l,"foo/bar/id not called again"),Finch.call("/foo/bar/123?x=Hello&y=World"),n(e,"foo not called again"),n(t,"foo/bar not called again"),n(l,"foo/bar/id not called again"),Finch.call("/foo/baz/456"),n(e,"foo not called again"),o(r,"foo/baz called"),o(d,"foo/baz/id called"),ok(r.calledBefore(d),"foo/baz called before foo/baz/id"),a(d,[{id:"456"}],"foo/baz/id bindings"),r.reset(),d.reset(),Finch.call("/quux/789?band=Sunn O)))&genre=Post-Progressive Fridgecore"),o(c,"quux called"),o(s,"quux/id called"),ok(c.calledBefore(s),"quux called before quux/id"),a(s,[{id:"789"}],"quux/id bindings")})),test("More hierarchical routing",sinon.test(function(){var e,a,t,l;return Finch.route("foo",e=this.stub()),Finch.route("[foo]/bar/baz",t=this.stub()),Finch.route("foo/bar",a=this.stub()),Finch.route("[foo/bar]/quux",l=this.stub()),Finch.call("/foo/bar/baz"),o(e,"foo called"),o(t,"foo/bar/baz called"),ok(e.calledBefore(t),"foo called before foo/bar/baz"),n(a,"foo/bar NOT called"),e.reset(),t.reset(),Finch.call("/foo/bar/quux"),o(a,"foo/bar called"),o(l,"foo/bar/quux called"),ok(a.calledBefore(l),"foo/bar called before foo/bar/quux"),n(e,"foo NOT called")})),test("Even more hierarchical routing",sinon.test(function(){var e,a;return Finch.route("foo",e=this.stub()),Finch.route("[foo]/bar",a=this.stub()),Finch.call("/foo"),o(e,"foo called"),n(a,"foo/bar not called"),e.reset(),a.reset(),Finch.call("/foo/bar"),n(e,"foo called"),o(a,"foo/bar called"),e.reset(),a.reset(),Finch.call("/foo"),o(e,"foo called"),n(a,"foo/bar not called")})),test("Hierarchical routing with /",sinon.test(function(){var e,a,t;return Finch.route("/",t=this.stub()),Finch.route("[/]foo",a=this.stub()),Finch.route("[/foo]/bar",e=this.stub()),Finch.call("/foo"),o(t,"/ called once"),o(a,"foo called once"),n(e,"bar never called"),t.reset(),a.reset(),e.reset(),Finch.call("/"),o(t,"/ called once"),n(a,"foo never called"),n(e,"bar never called")})),test("Simple routing with setup, load, and teardown",sinon.test(function(){var a;return a=e(),Finch.route("/",{setup:a.setup_slash=this.stub(),load:a.load_slash=this.stub(),teardown:a.teardown_slash=this.stub()}),Finch.route("/foo",{setup:a.setup_foo=this.stub(),load:a.load_foo=this.stub(),teardown:a.teardown_foo=this.stub()}),Finch.route("foo/bar",{setup:a.setup_foo_bar=this.stub(),load:a.load_foo_bar=this.stub(),teardown:a.teardown_foo_bar=this.stub()}),Finch.call("/"),o(a.setup_slash,"/: / setup called once"),o(a.load_slash,"/: / load called once"),n(a.teardown_slash,"/: / teardown not called"),a.reset(),Finch.call("/foo"),n(a.setup_slash,"/foo: / setup not called"),n(a.load_slash,"/foo: / load called once"),o(a.teardown_slash,"/foo: / teardown called once"),o(a.setup_foo,"/foo: foo setup called once"),o(a.load_foo,"/foo: foo load called once"),n(a.teardown_foo,"/foo: foo teardown not called"),a.reset(),Finch.call("/foo/bar"),n(a.setup_slash,"/foo/bar: / setup not called"),n(a.load_slash,"/foo/bar: / teardown not called"),n(a.teardown_slash,"/foo/bar: / teardown not called"),n(a.setup_foo,"/foo/bar: foo setup not called"),n(a.load_foo,"/foo/bar: foo load called once"),o(a.teardown_foo,"/foo/bar: foo teardown called once"),o(a.setup_foo_bar,"/foo/bar: foo/bar setup called once"),o(a.load_foo_bar,"/foo/bar: foo/bar load called once"),n(a.teardown_foo_bar,"/foo/bar: foo/bar teardown not called"),a.reset(),Finch.call("/foo/bar?baz=quux"),n(a.setup_slash,"/foo/bar?baz=quux: / setup not called"),n(a.load_slash,"/foo/bar?baz=quux: / load not called"),n(a.teardown_slash,"/foo/bar?baz=quux: / teardown not called"),n(a.setup_foo,"/foo/bar?baz=quux: foo setup not called"),n(a.load_foo,"/foo/bar?baz=quux: foo load not called"),n(a.teardown_foo,"/foo/bar?baz=quux: foo teardown not called"),n(a.setup_foo_bar,"/foo/bar?baz=quux: foo/bar setup not called"),n(a.load_foo_bar,"/foo/bar?baz=quux: foo/bar load not called"),n(a.teardown_foo_bar,"/foo/bar?baz=quux: foo/bar teardown not called"),a.reset(),Finch.call("/foo/bar?baz=xyzzy"),n(a.setup_slash,"/foo/bar?baz=xyzzy: / setup not called"),n(a.load_slash,"/foo/bar?baz=xyzzy: / load not called"),n(a.teardown_slash,"/foo/bar?baz=xyzzy: / teardown not called"),n(a.setup_foo,"/foo/bar?baz=xyzzy: foo setup not called"),n(a.load_foo,"/foo/bar?baz=xyzzy: foo load not called"),n(a.teardown_foo,"/foo/bar?baz=xyzzy: foo teardown not called"),n(a.setup_foo_bar,"/foo/bar?baz=xyzzy: foo/bar setup not called"),n(a.load_foo_bar,"/foo/bar?baz=xyzzy: foo/bar load not called"),n(a.teardown_foo_bar,"/foo/bar?baz=xyzzy: foo/bar teardown not called"),a.reset()})),test("Hierarchical routing with setup, load, and teardown",sinon.test(function(){var a;return a=e(),Finch.route("foo",{setup:a.setup_foo=this.stub(),load:a.load_foo=this.stub(),unload:a.unload_foo=this.stub(),teardown:a.teardown_foo=this.stub()}),Finch.route("[foo]/bar",{setup:a.setup_foo_bar=this.stub(),load:a.load_foo_bar=this.stub(),unload:a.unload_foo_bar=this.stub(),teardown:a.teardown_foo_bar=this.stub()}),Finch.route("[foo/bar]/:id",{setup:a.setup_foo_bar_id=this.stub(),load:a.load_foo_bar_id=this.stub(),unload:a.unload_foo_bar_id=this.stub(),teardown:a.teardown_foo_bar_id=this.stub()}),Finch.route("[foo]/baz",{setup:a.setup_foo_baz=this.stub(),load:a.load_foo_baz=this.stub(),unload:a.unload_foo_baz=this.stub(),teardown:a.teardown_foo_baz=this.stub()}),Finch.route("[foo/baz]/:id",{setup:a.setup_foo_baz_id=this.stub(),load:a.load_foo_baz_id=this.stub(),unload:a.unload_foo_baz_id=this.stub(),teardown:a.teardown_foo_baz_id=this.stub()}),Finch.call("/foo"),o(a.setup_foo,"/foo: foo setup"),o(a.load_foo,"/foo: foo load"),a.reset(),Finch.call("/foo/bar"),o(a.unload_foo,"/foo/bar: foo unload"),n(a.setup_foo,"/foo/bar: no foo setup"),n(a.load_foo,"/foo/bar: no foo load"),n(a.teardown_foo,"/foo/bar: no foo teardown"),o(a.setup_foo_bar,"/foo/bar: foo/bar setup"),o(a.load_foo_bar,"/foo/bar: foo/bar load"),a.reset(),Finch.call("/foo"),o(a.unload_foo_bar,"/foo: foo/bar unload"),o(a.teardown_foo_bar,"/foo return: foo/bar teardown"),o(a.load_foo,"/foo return: no foo load"),n(a.setup_foo,"/foo return: no foo setup"),a.reset(),Finch.call("/foo/bar/123?x=abc"),o(a.unload_foo,"/foo/bar/123: foo unload"),n(a.unload_foo_bar,"/foo/bar/123: no foo/bar unload"),n(a.teardown_foo,"/foo/bar/123: no foo teardown"),n(a.load_foo,"/foo/bar/123: no foo load"),n(a.setup_foo,"/foo/bar/123: no foo setup"),o(a.setup_foo_bar,"/foo/bar/123: foo/bar setup"),n(a.load_foo_bar,"/foo/bar/123: foo/bar load"),o(a.setup_foo_bar_id,"/foo/bar/123: foo/bar/id setup"),o(a.load_foo_bar_id,"/foo/bar/123: foo/bar/id load"),a.reset(),Finch.call("/foo/bar/456?x=aaa&y=zzz"),o(a.unload_foo_bar_id,"/foo/bar/456?x=aaa&y=zzz: foo/bar/id unload"),o(a.teardown_foo_bar_id,"/foo/bar/456?x=aaa&y=zzz: foo/bar/id teardown"),o(a.setup_foo_bar_id,"/foo/bar/456?x=aaa&y=zzz: foo/bar/id setup"),o(a.load_foo_bar_id,"/foo/bar/456?x=aaa&y=zzz: foo/bar/id load"),a.reset(),Finch.call("/foo/bar/456?x=bbb&y=zzz"),n(a.unload_foo_bar_id,"/foo/bar/456?x=bbb&y=zzz: no foo/bar/id unload"),n(a.teardown_foo_bar_id,"/foo/bar/456?x=bbb&y=zzz: no foo/bar/id teardown"),n(a.setup_foo_bar_id,"/foo/bar/456?x=bbb&y=zzz: no foo/bar/id setup"),n(a.load_foo_bar_id,"/foo/bar/456?x=bbb&y=zzz: no foo/bar/id load"),a.reset(),Finch.call("/foo/bar/456?y=zzz&x=bbb"),n(a.unload_foo_bar_id,"/foo/bar/456?x=bbb&y=zzz: no foo/bar/id unload"),n(a.teardown_foo_bar_id,"/foo/bar/456?x=bbb&y=zzz: no foo/bar/id teardown"),n(a.setup_foo_bar_id,"/foo/bar/456?y=zzz&x=bbb: no foo/bar/id setup"),n(a.load_foo_bar_id,"/foo/bar/456?y=zzz&x=bbb: no foo/bar/id load"),a.reset(),Finch.call("/foo/baz/789"),o(a.unload_foo_bar_id,"/foo/baz/789: foo/baz/id unload"),o(a.teardown_foo_bar_id,"/foo/baz/789: foo/baz/id teardown"),n(a.unload_foo_bar,"/foo/baz/789: no foo/bar unload"),o(a.teardown_foo_bar,"/foo/baz/789: foo/bar teardown"),n(a.unload_foo,"/foo/baz/789: no foo unload"),n(a.teardown_foo,"/foo/baz/789: no foo teardown"),n(a.setup_foo,"/foo/baz/789: no foo setup"),n(a.load_foo,"/foo/baz/789: no foo load"),o(a.setup_foo_baz,"/foo/baz/789: foo/baz setup"),n(a.load_foo_baz,"/foo/baz/789: foo/baz load"),o(a.setup_foo_baz_id,"/foo/baz/789: foo/baz/id setup"),o(a.load_foo_baz_id,"/foo/baz/789: foo/baz/id load"),a.reset(),Finch.call("/foo/baz/abc?term=Hello"),o(a.unload_foo_baz_id,"/foo/baz/abc?term=Hello: foo/baz/id unload"),o(a.teardown_foo_baz_id,"/foo/baz/abc?term=Hello: foo/baz/id teardown"),o(a.setup_foo_baz_id,"/foo/baz/abc?term=Hello: foo/baz/id setup"),o(a.load_foo_baz_id,"/foo/baz/abc?term=Hello: foo/baz/id load"),a.reset(),Finch.call("/foo/baz/abc?term=World"),n(a.unload_foo_baz_id,"/foo/baz/abc?term=World: no foo/baz/id unload"),n(a.teardown_foo_baz_id,"/foo/baz/abc?term=World: no foo/baz/id teardown"),n(a.setup_foo_baz_id,"/foo/baz/abc?term=World: no foo/baz/id setup"),n(a.load_foo_baz_id,"/foo/baz/abc?term=World: no foo/baz/id load")})),test("Calling with context",sinon.test(function(){var e,a,n,t,l;return Finch.route("foo",{setup:n=this.stub(),load:a=this.stub(),unload:l=this.stub(),teardown:t=this.stub()}),Finch.route("bar",this.stub()),Finch.call("/foo"),o(n,"foo setup called once"),e=n.getCall(0).thisValue,ok(a.calledOn(e),"foo load called on same context as setup"),Finch.call("/bar"),ok(l.calledOn(e),"foo load called on same context as setup"),ok(t.calledOn(e),"foo teardown called on same context as setup")})),test("Checking Parent Context",function(){return Finch.route("/",function(){return equal(this.parent,null,"Parent is null"),this.someData="Free Bird"}),Finch.route("[/]home",function(){return ok(null!==this.parent,"Parent is defined in simple version"),equal(this.parent.someData,"Free Bird","Correct parent passed in"),this.moreData="Hello World"}),Finch.route("[/home]/news",{setup:function(){return ok(null!==this.parent,"Parent is defined in setup"),equal(this.parent.moreData,"Hello World","Correct parent passed in"),equal(this.parent.parent.someData,"Free Bird","Correct parent's parent passed in")},load:function(){return ok(null!==this.parent,"Parent is defined in load"),equal(this.parent.moreData,"Hello World","Correct parent passed in"),equal(this.parent.parent.someData,"Free Bird","Correct parent's parent passed in")},unload:function(){return ok(null!==this.parent,"Parent is defined in unload"),equal(this.parent.moreData,"Hello World","Correct parent passed in"),equal(this.parent.parent.someData,"Free Bird","Correct parent's parent passed in")},teardown:function(){return ok(null!==this.parent,"Parent is defined in teardown"),equal(this.parent.moreData,"Hello World","Correct parent passed in"),equal(this.parent.parent.someData,"Free Bird","Correct parent's parent passed in")}}),Finch.route("/foo",{setup:function(){return equal(this.parent,null,"Parent is null in setup")},load:function(){return equal(this.parent,null,"Parent is null in load")},unload:function(){return equal(this.parent,null,"Parent is null in unload")},teardown:function(){return equal(this.parent,null,"Parent is null in teardown")}}),Finch.route("[/]bar",{setup:function(){return ok(null!==this.parent,"Parent is defined in simple version"),equal(this.parent.someData,"Free Bird","Correct parent passed in")},load:function(){return ok(null!==this.parent,"Parent is defined in simple version"),equal(this.parent.someData,"Free Bird","Correct parent passed in")},unload:function(){return ok(null!==this.parent,"Parent is defined in simple version"),equal(this.parent.someData,"Free Bird","Correct parent passed in")},teardown:function(){return ok(null!==this.parent,"Parent is defined in simple version"),equal(this.parent.someData,"Free Bird","Correct parent passed in")}}),Finch.call("/bar"),Finch.call("/home/news"),Finch.call("/foo"),Finch.call("/home/news"),Finch.call("/bar"),Finch.call("/foo")}),test("Hierarchical calling with context",sinon.test(function(){var e,a,n,t,l,r,d,c;return Finch.route("foo",{setup:l=this.stub(),load:n=this.stub(),teardown:d=this.stub()}),Finch.route("[foo]/bar",{setup:r=this.stub(),load:t=this.stub(),teardown:c=this.stub()}),Finch.route("baz",this.stub()),Finch.call("/foo"),o(l,"foo setup called once"),a=l.getCall(0).thisValue,ok(n.calledOn(a),"foo load called on same context as setup"),Finch.call("/foo/bar"),o(r,"foo/bar setup called once"),e=r.getCall(0).thisValue,ok(t.calledOn(e),"foo/bar load called on same context as setup"),notEqual(a,e,"foo/bar should be called on a different context than foo"),Finch.call("/baz"),o(c,"foo/bar teardown called once"),o(d,"foo teardown called once"),ok(c.calledBefore(d),"foo/bar teardown called before foo teardown"),ok(c.calledOn(e),"foo/bar teardown called on same context as setup"),ok(d.calledOn(a),"foo teardown called on same context as")})),test("Testing synchronous and asynchronous unload method and context",sinon.test(function(){var a,t,l,r;return r=e(),r.home_setup=this.stub(),r.home_load=this.stub(),r.home_unload=this.stub(),r.home_teardown=this.stub(),Finch.route("/home",{setup:function(e,o){return r.home_setup(),o()},load:function(e,o){return r.home_load(),o()},unload:function(e,o){return r.home_unload(),o()},teardown:function(e,o){return r.home_teardown(),o()}}),r.home_news_setup=this.stub(),r.home_news_load=this.stub(),r.home_news_unload=this.stub(),r.home_news_teardown=this.stub(),Finch.route("[/home]/news",{setup:function(e,o){return this.did_setup=!0,r.home_news_setup(),o()},load:function(e,o){return this.did_load=!0,r.home_news_load(),o()},unload:function(e,o){return this.did_unload=!0,r.home_news_unload(this,o)},teardown:function(e,o){return this.did_teardown=!0,r.home_news_teardown(),o()}}),Finch.route("/foo",r.foo=this.stub()),Finch.call("/home"),o(r.home_setup,"Called Home Setup"),o(r.home_load,"Called Home Load"),n(r.home_unload,"Never Called Home Unload"),n(r.home_teardown,"Never Called Home Teardown"),n(r.home_news_setup,"Never Called Home News Setup"),n(r.home_news_load,"Never Called Home News Load"),n(r.home_news_unload,"Never Called Home News Unload"),n(r.home_news_teardown,"Never Called Home News Teardown"),n(r.foo,"Never Called Foo"),ok(r.home_setup.calledBefore(r.home_load),"Called Home setup before load"),r.reset(),Finch.call("/home/news"),n(r.home_setup,"Never Called Home Setup"),n(r.home_load,"Never Called Home Load"),o(r.home_unload,"Called Home Unload"),n(r.home_teardown,"Never Called Home Teardown"),o(r.home_news_setup,"Called Home News Setup"),o(r.home_news_load,"Called Home News Load"),n(r.home_news_unload,"Never Called Home News Unload"),n(r.home_news_teardown,"Never Called Home News Teardown"),n(r.foo,"Never Called Foo"),ok(r.home_unload.calledBefore(r.home_news_setup),"Home unload called before Home/News setup"),ok(r.home_news_setup.calledBefore(r.home_news_load),"Home/News setup called before Home/News load"),r.reset(),Finch.call("/foo"),n(r.home_setup,"Never Called Home Setup"),n(r.home_load,"Never Called Home Load"),n(r.home_unload,"Never Called Home Unload"),n(r.home_teardown,"Never Called Home Teardown"),n(r.home_news_setup,"Never Called Home News Setup"),n(r.home_news_load,"Never Called Home News Load"),o(r.home_news_unload,"Never Called Home News Unload"),n(r.home_news_teardown,"Never Called Home News Teardown"),n(r.foo,"Never Called Foo"),a=r.home_news_unload.getCall(0),t=a.args[0],l=a.args[1],ok(null!=t.did_setup,"Setup was passed in context"),ok(null!=t.did_load,"Load was passed in context"),ok(null!=t.did_unload,"Unload was passed in context"),ok(null==t.did_teardown,"Teardown was not passed in context"),l(),n(r.home_setup,"Never Called Home Setup"),n(r.home_load,"Never Called Home Load"),n(r.home_unload,"Never Called Home Unload"),o(r.home_teardown,"Called Home Teardown"),n(r.home_news_setup,"Never Called Home News Setup"),n(r.home_news_load,"Never Called Home News Load"),o(r.home_news_unload,"Called Home News Unload"),o(r.home_news_teardown,"Called Home News Teardown"),o(r.foo,"Called Foo"),r.reset()})),test("Reload",sinon.test(function(){var a,t,l,r;return r=e(),r.home_setup=this.stub(),r.home_load=this.stub(),r.home_unload=this.stub(),r.home_teardown=this.stub(),Finch.route("/home",{setup:function(e,o){return r.home_setup(),o()},load:function(e,o){return r.home_load(),o()},unload:function(e,o){return r.home_unload(),o()},teardown:function(e,o){return r.home_teardown(),o()}}),r.home_news_setup=this.stub(),r.home_news_load=this.stub(),r.home_news_unload=this.stub(),r.home_news_teardown=this.stub(),Finch.route("[/home]/news",{setup:function(e,o){return this.did_setup=!0,r.home_news_setup(this,o)},load:function(e,o){return this.did_load=!0,r.home_news_load(this,o)},unload:function(e,o){return this.did_unload=!0,r.home_news_unload(this,o)},teardown:function(e,o){return this.did_teardown=!0,r.home_news_teardown(),o()}}),Finch.call("/home"),o(r.home_setup,"Called Home Setup"),o(r.home_load,"Called Home Load"),n(r.home_unload,"Never Called Home Unload"),n(r.home_teardown,"Never Called Home Teardown"),n(r.home_news_setup,"Never Called Home News Setup"),n(r.home_news_load,"Never Called Home News Load"),n(r.home_news_unload,"Never Called Home News Unload"),n(r.home_news_teardown,"Never Called Home News Teardown"),r.reset(),Finch.reload(),n(r.home_setup,"Never Called Home Setup"),o(r.home_load,"Called Home Load"),o(r.home_unload,"Called Home Unload"),n(r.home_teardown,"Never Called Home Teardown"),n(r.home_news_setup,"Never Called Home News Setup"),n(r.home_news_load,"Never Called Home News Load"),n(r.home_news_unload,"Never Called Home News Unload"),n(r.home_news_teardown,"Never Called Home News Teardown"),r.reset(),Finch.call("/home/news"),n(r.home_setup,"Never Called Home Setup"),n(r.home_load,"Never Called Home Load"),o(r.home_unload,"Called Home Unload"),n(r.home_teardown,"Never Called Home Teardown"),o(r.home_news_setup,"Called Home News Setup"),n(r.home_news_load,"Never Called Home News Load"),n(r.home_news_unload,"Never Called Home News Unload"),n(r.home_news_teardown,"Never Called Home News Teardown"),a=r.home_news_setup.getCall(0),t=a.args[0],l=a.args[1],ok(null!=t.did_setup,"Setup was passed in context"),ok(null==t.did_load,"Load was not passed in context"),ok(null==t.did_unload,"Unload was not passed in context"),ok(null==t.did_teardown,"Teardown was not passed in context"),r.reset(),Finch.reload(),n(r.home_setup,"Never Called Home Setup"),n(r.home_load,"Never Called Home Load"),n(r.home_unload,"Never Called Home Unload"),n(r.home_teardown,"Never Called Home Teardown"),n(r.home_news_setup,"Never Called Home News Setup"),n(r.home_news_load,"Never Called Home News Load"),n(r.home_news_unload,"Never Called Home News Unload"),n(r.home_news_teardown,"Never Called Home News Teardown"),r.reset(),l(),n(r.home_setup,"Never Called Home Setup"),n(r.home_load,"Never Called Home Load"),n(r.home_unload,"Never Called Home Unload"),n(r.home_teardown,"Never Called Home Teardown"),n(r.home_news_setup,"Never Called Home News Setup"),o(r.home_news_load,"Called Home News Load"),n(r.home_news_unload,"Never Called Home News Unload"),n(r.home_news_teardown,"Never Called Home News Teardown"),a=r.home_news_load.getCall(0),t=a.args[0],l=a.args[1],ok(null!=t.did_setup,"Setup was passed in context"),ok(null!=t.did_load,"Load was passed in context"),ok(null==t.did_unload,"Unload was not passed in context"),ok(null==t.did_teardown,"Teardown was not passed in context"),r.reset(),Finch.reload(),n(r.home_setup,"Never Called Home Setup"),n(r.home_load,"Never Called Home Load"),n(r.home_unload,"Never Called Home Unload"),n(r.home_teardown,"Never Called Home Teardown"),n(r.home_news_setup,"Never Called Home News Setup"),n(r.home_news_load,"Never Called Home News Load"),n(r.home_news_unload,"Never Called Home News Unload"),n(r.home_news_teardown,"Never Called Home News Teardown"),r.reset(),l(),Finch.reload(),n(r.home_setup,"Never Called Home Setup"),n(r.home_load,"Never Called Home Load"),n(r.home_unload,"Never Called Home Unload"),n(r.home_teardown,"Never Called Home Teardown"),n(r.home_news_setup,"Never Called Home News Setup"),n(r.home_news_load,"Never Called Home News Load"),o(r.home_news_unload,"Called Home News Unload"),n(r.home_news_teardown,"Never Called Home News Teardown"),a=r.home_news_unload.getCall(0),t=a.args[0],l=a.args[1],ok(null!=t.did_setup,"Setup was passed in context"),ok(null!=t.did_load,"Load was passed in context"),ok(null!=t.did_unload,"Unload was passed in context"),ok(null==t.did_teardown,"Teardown was not passed in context"),r.reset(),Finch.reload(),n(r.home_setup,"Never Called Home Setup"),n(r.home_load,"Never Called Home Load"),n(r.home_unload,"Never Called Home Unload"),n(r.home_teardown,"Never Called Home Teardown"),n(r.home_news_setup,"Never Called Home News Setup"),n(r.home_news_load,"Never Called Home News Load"),n(r.home_news_unload,"Never Called Home News Unload"),n(r.home_news_teardown,"Never Called Home News Teardown"),r.reset(),l(),n(r.home_setup,"Never Called Home Setup"),n(r.home_load,"Never Called Home Load"),n(r.home_unload,"Never Called Home Unload"),n(r.home_teardown,"Never Called Home Teardown"),n(r.home_news_setup,"Never Called Home News Setup"),o(r.home_news_load,"Called Home News Load"),n(r.home_news_unload,"Never Called Home News Unload"),n(r.home_news_teardown,"Never Called Home News Teardown"),a=r.home_news_load.getCall(0),t=a.args[0],l=a.args[1],ok(null!=t.did_setup,"Setup was passed in context"),ok(null!=t.did_load,"Load was passed in context"),ok(null!=t.did_unload,"Unload was passed in context"),ok(null==t.did_teardown,"Teardown was not passed in context")})),test("Route sanitation",sinon.test(function(){var e,a,t;return Finch.route("/",t=this.stub()),Finch.route("/foo",e=this.stub()),Finch.route("/foo/bar",a=this.stub()),Finch.call(""),o(t,"/ called once"),t.reset(),Finch.call("/"),n(t,"/ not called again"),t.reset(),Finch.call(""),n(t,"/ not called again"),t.reset(),Finch.call("//"),n(t,"/ not called again"),t.reset(),Finch.call("foo"),n(t,"/ not called again"),o(e,"foo called once"),t.reset(),e.reset(),Finch.call("/foo"),n(t,"/ not called again"),n(e,"foo not called again"),t.reset(),e.reset(),Finch.call("/foo/"),n(t,"/ not called again"),n(e,"foo not called again"),t.reset(),e.reset(),Finch.call("foo/"),n(t,"/ not called again"),n(e,"foo not called again"),t.reset(),e.reset(),Finch.call("foo/bar"),n(t,"/ not called again"),n(e,"foo not called again"),o(a,"foo/bar called once"),t.reset(),e.reset(),a.reset(),Finch.call("/foo/bar"),n(t,"/ not called again"),n(e,"foo not called again"),n(a,"foo/bar not called again"),t.reset(),e.reset(),a.reset(),Finch.call("/foo/bar/"),n(t,"/ not called again"),n(e,"foo not called again"),n(a,"foo/bar not called again"),t.reset(),e.reset(),a.reset(),Finch.call("foo/bar/"),n(t,"/ not called again"),n(e,"foo not called again"),n(a,"foo/bar not called again"),t.reset(),e.reset(),a.reset()})),test("Asynchronous setup, load, and teardown",sinon.test(function(){var a;return a=e(),a.setup_foo=this.stub(),a.load_foo=this.stub(),a.teardown_foo=this.stub(),a.setup_foo_bar=this.stub(),a.load_foo_bar=this.stub(),Finch.route("foo",{setup:function(e,o){return a.setup_foo(e,o)},load:function(e,o){return a.load_foo(e,o)},teardown:function(e,o){return a.teardown_foo(e,o)}}),Finch.route("foo/bar",{setup:function(e,o){return a.setup_foo_bar(e,o)},load:function(e,o){return a.load_foo_bar(e,o)},teardown:a.teardown_foo_bar=this.stub()}),Finch.route("[foo/bar]/baz",{setup:a.setup_foo_bar_baz=this.stub(),teardown:a.teardown_foo_bar_baz=this.stub()}),Finch.route("quux",{setup:a.setup_quux=this.stub()}),Finch.call("/foo"),o(a.setup_foo,"/foo (before /foo callback): foo setup called once"),n(a.load_foo,"/foo (after /foo callback): foo load not called"),n(a.teardown_foo,"/foo (after /foo callback): foo teardown not called"),a.setup_foo.callArg(1),o(a.setup_foo,"/foo (after /foo callback): foo setup not called again"),o(a.load_foo,"/foo (before /foo callback): foo load called once"),n(a.teardown_foo,"/foo (after /foo callback): foo teardown not called"),a.load_foo.callArg(1),o(a.setup_foo,"/foo (after /foo callback): foo setup not called again"),o(a.load_foo,"/foo (after /foo callback): foo load not called again"),n(a.teardown_foo,"/foo (after /foo callback): foo teardown not called"),a.reset(),Finch.call("/foo/bar/baz"),o(a.teardown_foo,"/foo/bar/baz (before /foo teardown): foo teardown called once"),n(a.setup_foo_bar,"/foo/bar/baz (before /foo teardown): foo/bar setup not called yet"),n(a.load_foo_bar,"/foo/bar/baz (before /foo teardown): foo/bar load not called yet"),a.teardown_foo.callArg(1),o(a.setup_foo_bar,"/foo/bar/baz (before /foo/bar callback): foo/bar setup called once"),n(a.load_foo_bar,"/foo/bar/baz (before /foo/bar callback): foo/bar load not called"),n(a.setup_foo_bar_baz,"/foo/bar/baz (before /foo/bar callback): foo/bar/baz setup not called yet"),Finch.call("/quux"),o(a.setup_foo_bar,"/quux (before /foo/bar callback): foo/bar setup not called again"),n(a.setup_foo_bar_baz,"/quux (before /foo/bar callback): foo/bar/baz setup not called"),n(a.setup_quux,"/quux (before /foo/bar callback): quux setup not called yet"),a.setup_foo_bar.callArg(1),equal(a.setup_foo_bar.callCount,1,"/quux (after /foo/bar callback): foo/bar setup not called again"),equal(a.teardown_foo_bar.callCount,1,"/quux (after /foo/bar callback): foo/bar teardown called"),equal(a.setup_foo_bar_baz.callCount,0,"/quux (after /foo/bar callback): foo/bar/baz setup not called"),equal(a.teardown_foo_bar_baz.callCount,0,"/quux (after /foo/bar callback): foo/bar/baz teardown not called"),equal(a.setup_quux.callCount,1,"/quux (after /foo/bar callback): quux setup called"),o(a.setup_foo_bar,"/quux (after /foo/bar callback): foo/bar setup not called again"),o(a.teardown_foo_bar,"/quux (after /foo/bar callback): foo/bar teardown called"),n(a.setup_foo_bar_baz,"/quux (after /foo/bar callback): foo/bar/baz setup not called"),n(a.teardown_foo_bar_baz,"/quux (after /foo/bar callback): foo/bar/baz teardown not called"),o(a.setup_quux,"/quux (after /foo/bar callback): quux setup called")})),function(){var e;return e=function(e){return Finch.call("/foo"),o(e,"observable callback called once"),a(e,[void 0,void 0],"called with given args"),e.reset(),Finch.call("/foo?sort=asc"),o(e,"observable callback called once"),a(e,["asc",void 0],"called with given args"),e.reset(),Finch.call("/foo"),o(e,"observable callback called once"),a(e,[void 0,void 0],"called with given args"),e.reset(),Finch.call("/foo?query=unicorn"),o(e,"observable callback called once"),a(e,[void 0,"unicorn"],"called with given args"),e.reset(),Finch.call("/foo?query=unicorn&sort=desc"),o(e,"observable callback called once"),a(e,["desc","unicorn"],"called with given args"),e.reset(),Finch.call("/foo?sort=desc&query=unicorn"),n(e,"observable callback not called"),e.reset(),Finch.call("/foo"),o(e,"observable callback called once"),a(e,[void 0,void 0],"called with given args"),e.reset(),Finch.call("/foo?Unrelated=Parameter"),n(e,"observable callback not called")},test("Trivial observable test (accessor form)",sinon.test(function(){var o;return o=this.stub(),Finch.route("foo",function(){return Finch.observe(function(e){return o(e("sort"),e("query"))})}),e(o)})),test("Trivial observable test (binding array form)",sinon.test(function(){var o;return o=this.stub(),Finch.route("foo",function(){return Finch.observe(["sort","query"],function(e,a){return o(e,a)})}),e(o)})),test("Trivial observable test (binding list form)",sinon.test(function(){var o;return o=this.stub(),Finch.route("foo",function(){return Finch.observe("sort","query",function(e,a){return o(e,a)})}),e(o)}))}(),test("Observable dependency tracking",sinon.test(function(){var e,t;return t=this.stub(),e=this.stub(),Finch.route("bar",function(){return Finch.observe(function(o){return o("flag")?t(o("on")):e(o("off"))})}),Finch.call("/bar"),o(e,"off callback called once"),n(t,"on callback not called"),a(e,[void 0],"called with given args"),e.reset(),Finch.call("/bar?off=Grue"),o(e,"off callback called once"),n(t,"on callback not called"),a(e,["Grue"],"called with given args"),e.reset(),Finch.call("/bar?off=Grue&on=Lantern"),n(e,"off callback not called"),n(t,"on callback not called"),Finch.call("/bar?flag=true&off=Grue&on=Lantern"),n(e,"off callback not called"),o(t,"on callback called once"),a(t,["Lantern"],"called with given args"),t.reset(),Finch.call("/bar?flag=true&on=Lantern"),n(e,"off callback not called"),n(t,"on callback not called")})),test("Observable hierarchy 1",sinon.test(function(){var e,t,l;return t=this.stub(),e=this.stub(),l=this.stub(),Finch.route("foo",function(){return Finch.observe(["a"],function(e){return t(e)})}),Finch.route("[foo]/bar",function(){return Finch.observe(["b"],function(o){return e(o)})}),Finch.route("[foo/bar]/:id",function(){return Finch.observe(["c"],function(e){return l(e)})}),Finch.call("/foo/bar?&a=1&b=2&c=3"),o(t,"foo callback called once"),a(t,["1"],"foo callback args"),o(e,"bar callback called once"),a(e,["2"],"bar callback args"),n(l,"id callback not called"),t.reset(),e.reset(),l.reset(),Finch.call("/foo/bar?a=1&b=2&c=11"),n(t,"foo callback not called"),n(e,"bar callback not called"),n(l,"id callback not called"),t.reset(),e.reset(),l.reset(),Finch.call("/foo?a=21&b=2&c=23"),o(t,"foo callback called once"),a(t,["21"],"foo callback args"),n(e,"bar callback not called"),n(l,"id callback not called"),t.reset(),e.reset(),l.reset(),Finch.call("/foo?a=31&b=32&c=23"),o(t,"foo callback called once"),a(t,["31"],"foo callback args"),n(e,"bar callback not called"),n(l,"id callback not called")})),test("Observable hierarchy 2",sinon.test(function(){var e,t,l,r;return r=this.stub(),t=this.stub(),e=this.stub(),l=this.stub(),Finch.route("/",function(){return Finch.observe(["x"],function(e){return r(e)})}),Finch.route("[/]foo",function(){return Finch.observe(["a"],function(e){return t(e)})}),Finch.route("[/foo]/bar",function(){return Finch.observe(["b"],function(o){return e(o)})}),Finch.route("[/foo/bar]/:id",function(){return Finch.observe(["c"],function(e){return l(e)})}),Finch.call("/foo/bar?x=0&a=1&b=2&c=3"),o(r,"/ callback called once"),a(r,["0"],"/ callback args"),o(t,"foo callback called once"),a(t,["1"],"foo callback args"),o(e,"bar callback called once"),a(e,["2"],"bar callback args"),n(l,"id callback not called"),r.reset(),t.reset(),e.reset(),l.reset(),Finch.call("/foo/bar?x=0&a=1&b=10&c=11"),n(r,"/ callback not called"),n(t,"foo callback not called"),o(e,"bar callback called once"),a(e,["10"],"bar callback args"),n(l,"id callback not called")
})),test("Observable value types",sinon.test(function(){var e;return e=this.stub(),Finch.route("/",function(){return Finch.observe(["x"],function(o){return e(o)})}),Finch.call("/?x=123"),o(e,"/ callback called once"),a(e,["123"],"/ called with correct 123"),e.reset(),Finch.call("/?x=123.456"),o(e,"/ callback called once"),a(e,["123.456"],"/ called with correct 123.456"),e.reset(),Finch.call("/?x=true"),o(e,"/ callback called once"),a(e,["true"],"/ called with correct true"),e.reset(),Finch.call("/?x=false"),o(e,"/ callback called once"),a(e,["false"],"/ called with correct false"),e.reset(),Finch.call("/?x=stuff"),o(e,"/ callback called once"),a(e,["stuff"],"/ called with correct stuff"),e.reset(),Finch.options({CoerceParameterTypes:!0}),Finch.call("/?x=123"),o(e,"/ callback called once"),a(e,[123],"/ called with correct 123"),e.reset(),Finch.call("/?x=123.456"),o(e,"/ callback called once"),a(e,[123.456],"/ called with correct 123.456"),e.reset(),Finch.call("/?x=true"),o(e,"/ callback called once"),a(e,[!0],"/ called with correct true"),e.reset(),Finch.call("/?x=false"),o(e,"/ callback called once"),a(e,[!1],"/ called with correct false"),e.reset(),Finch.call("/?x=stuff"),o(e,"/ callback called once"),a(e,["stuff"],"/ called with correct stuff"),e.reset()})),test("Binding value types",sinon.test(function(){var e;return e=this.stub(),Finch.route("/:x",function(o){var a;return a=o.x,e(a)}),Finch.call("/123"),o(e,"/ callback called once"),a(e,["123"],"/ called with correct 123"),e.reset(),Finch.call("/123.456"),o(e,"/ callback called once"),a(e,["123.456"],"/ called with correct 123.456"),e.reset(),Finch.call("/true"),o(e,"/ callback called once"),a(e,["true"],"/ called with correct true"),e.reset(),Finch.call("/false"),o(e,"/ callback called once"),a(e,["false"],"/ called with correct false"),e.reset(),Finch.call("/stuff"),o(e,"/ callback called once"),a(e,["stuff"],"/ called with correct stuff"),e.reset(),Finch.options({CoerceParameterTypes:!0}),Finch.call("/123"),o(e,"/ callback called once"),a(e,[123],"/ called with correct 123"),e.reset(),Finch.call("/123.456"),o(e,"/ callback called once"),a(e,[123.456],"/ called with correct 123.456"),e.reset(),Finch.call("/true"),o(e,"/ callback called once"),a(e,[!0],"/ called with correct true"),e.reset(),Finch.call("/false"),o(e,"/ callback called once"),a(e,[!1],"/ called with correct false"),e.reset(),Finch.call("/stuff"),o(e,"/ callback called once"),a(e,["stuff"],"/ called with correct stuff"),e.reset()})),test("Finch.navigate",sinon.test(function(){var e,o,a,n,t,l;return window.location.hash="",e=function(){var e;return"#"+(null!=(e=window.location.href.split("#",2)[1])?e:"")},l=/^#?\/home/,t=/^#?\/home\/news/,a=/^#?\/home\/account/,n=/^#?\/home\/news\/article/,o=/^#?\/hello%20world/,Finch.navigate("/home"),ok(l.test(e()),"Navigate called and changed hash to /home"),Finch.navigate("/home/news"),ok(t.test(e()),"Navigate called and changed hash to /home/news"),Finch.navigate("/home"),ok(l.test(e()),"fNavigate called and changed hash to /home"),Finch.navigate("/home",{foo:"bar"}),ok(l.test(e()),"Navigate remained on the /home route"),ok(e().indexOf("foo=bar")>-1,"Had correct query parameter set"),Finch.navigate("/home",{hello:"world"}),ok(l.test(e()),"Navigate remained on the /home route"),ok(-1===e().indexOf("foo=bar"),"Removed foo=bar"),ok(e().indexOf("hello=world")>-1,"Added hello=world"),Finch.navigate({foos:"bars"}),ok(l.test(e()),"Navigate remained on the /home route"),ok(-1===e().indexOf("hello=world"),"Removed hello=world"),ok(e().indexOf("foos=bars")>-1,"Added foos=bars"),Finch.navigate({foos:"baz"}),ok(l.test(e()),"Navigate remained on the /home route"),ok(e().indexOf("foos=baz")>-1,"Changed to foos=baz"),Finch.navigate({hello:"world"},!0),ok(l.test(e()),"Navigate remained on the /home route"),ok(e().indexOf("foos=baz")>-1,"Kept foos=baz"),ok(e().indexOf("hello=world")>-1,"Added hello=world"),Finch.navigate({foos:null},!0),ok(l.test(e()),"Navigate remained on the /home route"),ok(-1===e().indexOf("foos=baz"),"Removed foos=baz"),ok(e().indexOf("hello=world")>-1,"Kept hello=world"),Finch.navigate("/home/news",!0),ok(t.test(e()),"Navigate called and changed hash to /home/news"),ok(e().indexOf("hello=world")>-1,"Kept hello=world"),Finch.navigate("/hello world",{}),ok(o.test(e()),"Navigated to /hello%20world"),ok(-1===e().indexOf("hello=world"),"Removed hello=world"),Finch.navigate("/hello world",{foo:"bar bar"}),ok(o.test(e()),"Navigate remained at /hello%20world"),ok(e().indexOf("foo=bar%20bar")>-1,"Added and escaped foo=bar bar"),Finch.navigate({foo:"baz baz"}),ok(o.test(e()),"Navigate remained at /hello%20world"),ok(-1===e().indexOf("foo=bar%20bar"),"Removed foo=bar bar"),ok(e().indexOf("foo=baz%20baz")>-1,"Added and escaped foo=baz baz"),Finch.navigate({hello:"world world"},!0),ok(o.test(e()),"Navigate remained at /hello%20world"),ok(e().indexOf("foo=baz%20baz")>-1,"Kept and escaped foo=baz baz"),ok(e().indexOf("hello=world%20world")>-1,"Added and escaped hello=world world"),Finch.navigate("/home?foo=bar",{hello:"world"}),ok(l.test(e()),"Navigate called and changed hash to /home"),ok(e().indexOf("foo=bar")>-1,"Had correct query parameter set foo=bar"),ok(e().indexOf("hello=world")>-1,"Had correct query parameter set hello=world"),equal(e().split("?").length-1,1,"Correct number of '?'"),equal(e().split("&").length-1,1,"Correct number of '&'"),Finch.navigate("/home?foo=bar",{hello:"world",foo:"baz"}),ok(l.test(e()),"Navigate called and changed hash to /home"),ok(-1===e().indexOf("foo=bar"),"foo=bar not set"),ok(e().indexOf("foo=baz")>-1,"Had correct query parameter set foo=baz"),ok(e().indexOf("hello=world")>-1,"Had correct query parameter set hello=world"),equal(e().split("?").length-1,1,"Correct number of '?'"),equal(e().split("&").length-1,1,"Correct number of '&'"),Finch.navigate("/home?foo=bar",{hello:"world",free:"bird"}),ok(l.test(e()),"Navigate called and changed hash to /home"),ok(e().indexOf("foo=bar")>-1,"Had correct query parameter set foo=bar"),ok(e().indexOf("free=bird")>-1,"Had correct query parameter set free=bird"),ok(e().indexOf("hello=world")>-1,"Had correct query parameter set hello=world"),equal(e().split("?").length-1,1,"Correct number of '?'"),equal(e().split("&").length-1,2,"Correct number of '&'"),Finch.navigate("#/home",!0),ok(l.test(e()),"Navigate called and changed hash to /home"),ok(e().indexOf("free=bird")>-1,"Had correct query parameter set free=bird"),ok(e().indexOf("hello=world")>-1,"Had correct query parameter set hello=world"),Finch.navigate("#/home"),ok(l.test(e()),"Navigate called and changed hash to /home"),ok(-1===e().indexOf("free=bird"),"Had correct query parameter set free=bird"),ok(-1===e().indexOf("hello=world"),"Had correct query parameter set hello=world"),Finch.navigate("#/home/news",{free:"birds",hello:"worlds"}),ok(t.test(e()),"Navigate called and changed hash to /home"),ok(e().indexOf("free=birds")>-1,"Had correct query parameter set free=birds"),ok(e().indexOf("hello=worlds")>-1,"Had correct query parameter set hello=worlds"),Finch.navigate("#/home/news",{foo:"bar"},!0),ok(t.test(e()),"Navigate called and changed hash to /home"),ok(e().indexOf("free=birds")>-1,"Had correct query parameter set free=birds"),ok(e().indexOf("hello=worlds")>-1,"Had correct query parameter set hello=worlds"),ok(e().indexOf("foo=bar")>-1,"Had correct query parameter set hello=worlds"),Finch.navigate("/home/news"),ok(t.test(e()),"Navigate called and changed hash to /home/news"),Finch.navigate("../"),ok(l.test(e()),"Navigate called and changed hash to /home"),Finch.navigate("./"),ok(l.test(e()),"Navigate called and changed hash to /home"),Finch.navigate("./news"),ok(t.test(e()),"Navigate called and changed hash to /home/news"),Finch.navigate("/home/news/article"),ok(n.test(e()),"Navigate called and changed hash to /home/news/article"),Finch.navigate("../../account"),ok(a.test(e()),"Navigate called and changed hash to /home/account")})),test("Finch.listen and Finch.ignore",sinon.test(function(){var o,a,n;return null==(n=window.hasOwnProperty)&&(window.hasOwnProperty=function(e){return e in this}),o=e(),o.attachEvent=this.stub(),o.detachEvent=this.stub(),o.addEventListener=this.stub(),o.removeEventListener=this.stub(),o.setInterval=this.stub(),o.clearInterval=this.stub(),a=function(){return"attachEvent"in window&&(window.attachEvent=null),"detachEvent"in window&&(window.detachEvent=null),"addEventListener"in window&&(window.addEventListener=null),"removeEventListener"in window&&(window.removeEventListener=null),"setInterval"in window&&(window.setInterval=null),"clearInterval"in window?window.clearInterval=null:void 0},a(),window.setInterval=o.setInterval,window.clearInterval=o.clearInterval,o.reset(),ok(Finch.listen(),"Finch successfully listening"),equal(o.addEventListener.callCount,0,"addEventListener not called"),equal(o.attachEvent.callCount,0,"attachEvent not called"),equal(o.setInterval.callCount,1,"setInterval called once"),ok(Finch.ignore(),"Finch successfuly ignoring"),equal(o.removeEventListener.callCount,0,"removeEventListener not called"),equal(o.detachEvent.callCount,0,"detachEvent not called"),equal(o.clearInterval.callCount,1,"clearInterval called once"),a(),window.onhashchange="defined",window.addEventListener=o.addEventListener,window.removeEventListener=o.removeEventListener,o.reset(),ok(Finch.listen(),"Finch successfully listening"),equal(o.addEventListener.callCount,1,"addEventListener Called once"),equal(o.attachEvent.callCount,0,"attachEvent not called"),equal(o.setInterval.callCount,0,"setInterval not called"),ok(Finch.ignore(),"Finch successfuly ignoring"),equal(o.removeEventListener.callCount,1,"removeEventListener Called once"),equal(o.detachEvent.callCount,0,"detachEvent not called"),equal(o.clearInterval.callCount,0,"clearInterval not called"),a(),window.onhashchange="defined",window.attachEvent=o.attachEvent,window.detachEvent=o.detachEvent,o.reset(),ok(Finch.listen(),"Finch successfully listening"),equal(o.addEventListener.callCount,0,"addEventListener not called"),equal(o.attachEvent.callCount,1,"attachEvent called once"),equal(o.setInterval.callCount,0,"setInterval not called"),ok(Finch.ignore(),"Finch successfuly ignoring"),equal(o.removeEventListener.callCount,0,"removeEventListener not called"),equal(o.detachEvent.callCount,1,"detachEvent called once"),equal(o.clearInterval.callCount,0,"clearInterval not called")})),test("Finch.abort",sinon.test(function(){var e,o;return o=this.stub(),e=this.stub(),Finch.route("/home",function(){return o()}),Finch.route("/foo",function(){return e()}),Finch.call("home"),equal(o.callCount,1,"Home called correctly"),equal(e.callCount,0,"Foo not called"),o.reset(),e.reset(),Finch.call("foo"),equal(o.callCount,0,"Home not called"),equal(e.callCount,0,"Foo not called"),o.reset(),e.reset(),Finch.abort(),Finch.call("foo"),equal(o.callCount,0,"Home not called"),equal(e.callCount,1,"Foo called correctly")})),test("Route finding backtracking 1",sinon.test(function(){var e,t,l,r,d,c;return Finch.route("/foo",l=this.stub()),Finch.route("[/foo]/bar",e=this.stub()),Finch.route("[/foo/bar]/baz",t=this.stub()),Finch.route("/:var1",r=this.stub()),Finch.route("[/:var1/]:var2",d=this.stub()),Finch.route("[/:var1/:var2]/:var3",c=this.stub()),Finch.call("/foo/nope"),o(r,"var1 called once"),a(r,[{var1:"foo"}],"var1 called with binding for var1"),o(d,"var2 called once"),a(d,[{var1:"foo",var2:"nope"}],"var2 called with bindings for var1 and var2"),n(l,"foo never called")})),test("Route finding backtracking 2",sinon.test(function(){var e,t,l,r,d,c;return Finch.route("/foo",l=this.stub()),Finch.route("[/foo]/bar",e=this.stub()),Finch.route("[/foo/bar]/baz",t=this.stub()),Finch.route("/:var1",r=this.stub()),Finch.route("[/:var1/]:var2",d=this.stub()),Finch.route("[/:var1/:var2]/:var3",c=this.stub()),Finch.call("/foo/bar/nope"),o(r,"var1 called once"),a(r,[{var1:"foo"}],"var1 called with binding for var1"),o(d,"var2 called once"),a(d,[{var1:"foo",var2:"bar"}],"var2 called with bindings for var1 and var2"),o(c,"var3 called once"),a(c,[{var1:"foo",var2:"bar",var3:"nope"}],"var3 called with bindings for var1, var2 and var3"),n(l,"foo never called"),n(e,"bar never called")})),test("Optional parameter parsing",sinon.test(function(){var e;return Finch.route("/"),Finch.route("/home/news/:id",e=this.stub()),Finch.call("/home/news/1234"),o(e,"foo called once"),a(e,[{id:"1234"}],"foo called with int parameter"),e.reset(),Finch.options({CoerceParameterTypes:!0}),Finch.call("/"),Finch.call("/home/news/1234"),o(e,"foo called once"),a(e,[{id:1234}],"foo called with string parameter")})),test("Variable parent routes called if no children found",sinon.test(function(){var t;return t=e(),Finch.route("/",{setup:t.slash_setup=this.stub(),load:t.slash_load=this.stub(),unload:t.slash_unload=this.stub(),teardown:t.slash_teardown=this.stub()}),Finch.route("[/]users/profile",{setup:t.profile_setup=this.stub(),load:t.profile_load=this.stub(),unload:t.profile_unload=this.stub(),teardown:t.profile_teardown=this.stub()}),Finch.route("[/]:page",{setup:t.page_setup=this.stub(),load:t.page_load=this.stub(),unload:t.page_unload=this.stub(),teardown:t.page_teardown=this.stub()}),Finch.call("/users"),o(t.slash_setup,"slash setup called once"),n(t.slash_load,"slash load never called"),n(t.slash_unload,"slash unload never called"),n(t.slash_teardown,"slash teardown never called"),o(t.page_setup,"page setup called once"),o(t.page_load,"page load called once"),n(t.page_unload,"page unload never called"),n(t.page_teardown,"page unload never called"),n(t.profile_setup,"profile setup never called"),n(t.profile_load,"profile load never called"),n(t.profile_unload,"profile unload never called"),n(t.profile_teardown,"profile teardown never called"),a(t.page_setup,[{page:"users"}],"page setup called with correct parameters"),a(t.page_load,[{page:"users"}],"page setup called with correct parameters")})),test("Test double deep variable basic routes up and down",sinon.test(function(){var t;return t=e(),Finch.route("/project/:project_id",t.project_id_load=this.stub()),Finch.route("[/project/:project_id]/milestone",t.milestone_load=this.stub()),Finch.route("[/project/:project_id/milestone]/:milestone_id",t.milestone_id_load=this.stub()),Finch.call("/project/1234"),o(t.project_id_load),n(t.milestone_load),n(t.milestone_id_load),a(t.project_id_load,[{project_id:"1234"}]),t.reset(),Finch.call("/project/1234/milestone"),n(t.project_id_load),o(t.milestone_load),n(t.milestone_id_load),a(t.milestone_load,[{project_id:"1234"}]),t.reset(),Finch.call("/project/1234/milestone/5678"),n(t.project_id_load),n(t.milestone_load),o(t.milestone_id_load),a(t.milestone_id_load,[{project_id:"1234",milestone_id:"5678"}]),t.reset(),Finch.call("/project/1234/milestone"),n(t.project_id_load),o(t.milestone_load),n(t.milestone_id_load),a(t.milestone_load,[{project_id:"1234"}]),t.reset(),Finch.call("/project/1234"),o(t.project_id_load),n(t.milestone_load),n(t.milestone_id_load),a(t.project_id_load,[{project_id:"1234"}]),t.reset()}))}).call(this);