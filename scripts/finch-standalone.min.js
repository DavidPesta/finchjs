(function(){var e,o,n,a,t,l,r,i,c,s,u,d,f,h,b,p,_,w,v,m,g,F,k,z,x,C,N,H,q,y,O,L,E,S,T,P,j,I,V,U,B,D,A,W,R,$,G,M,K,Q,J,X,Y,Z,eo,oo,no,ao,to,lo,ro,io,co=[].slice;U=function(e){return typeof e==typeof{}&&null!==e},I=function(e){return"[object Function]"===Object.prototype.toString.call(e)},j=function(e){return"[object Boolean]"===Object.prototype.toString.call(e)},P=function(e){return"[object Array]"===Object.prototype.toString.call(e)},B=function(e){return"[object String]"===Object.prototype.toString.call(e)},V=function(e){return"[object Number]"===Object.prototype.toString.call(e)},to=function(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")},lo=function(e){return e.replace(/^\//,"").replace(/\/$/,"")},Y=function(e,o){return 0===e.indexOf(o)},H=function(e,o){return-1!==e.indexOf(o,e.length-o.length)},x=function(e,o){var n,a,t;if(I(e.indexOf))return-1!==e.indexOf(o);if(P(e))for(a=0,t=e.length;t>a;a++)if(n=e[a],n===o)return!0;return!1},M=function(e){return e[e.length-1]},C=function(e,o){return e.split(o).length-1},D=function(e){var o,n;n=[];for(o in e)n.push(o);return n},A=function(e){var o,n,a;a=[];for(o in e)n=e[o],a.push(n);return a},q=function(e,o){var n,a;U(e)||(e={}),U(o)||(o={});for(n in o)a=o[n],e[n]=a;return e},k=function(e){var o,n,a;U(e)||(e={}),n={};for(o in e)a=e[o],null!=a&&(n[o]=a);return n},W=function(e,o){var n,a;for(n in e)if(a=e[n],o[n]!==a)return!1;for(n in o)if(a=o[n],e[n]!==a)return!1;return!0},F=function(e,o){var n,a,t,l;if(e.length!==o.length)return!1;for(n=t=0,l=e.length;l>t;n=++t)if(a=e[n],o[n]!==a)return!1;return!0},N=function(e,o){var n,a,t;null==e&&(e={}),null==o&&(o={}),a={};for(n in e)t=e[n],o[n]!==t&&(a[n]=o[n]);for(n in o)t=o[n],e[n]!==t&&(a[n]=t);return a},(z===void 0||null===z)&&(z={}),null==(ro=z.log)&&(z.log=function(){}),null==(io=z.warn)&&(z.warn=function(){}),h=function(){function e(e){var o,n;n=e.components,o=e.childIndex,this.components=null!=n?n:[],this.childIndex=null!=o?o:0}return e}(),_=function(){function e(e){var o,n,a,t;t=null!=e?e:{},o=t.name,n=t.nodeType,a=t.parent,this.name=null!=o?o:"",this.nodeType=null!=n?n:null,this.parent=null!=a?a:null,this.routeSettings=null,this.childLiterals={},this.childVariable=null,this.bindings=[]}return e}(),v=function(){function e(e){var o,n,a,t,l,r;r=null!=e?e:{},a=r.setup,t=r.teardown,n=r.load,l=r.unload,o=r.context,this.setup=I(a)?a:function(){},this.load=I(n)?n:function(){},this.unload=I(l)?l:function(){},this.teardown=I(t)?t:function(){},this.context=U(o)?o:{}}return e}(),w=function(){function e(e){var o,n,a,t;t=null!=e?e:{},n=t.node,o=t.boundValues,a=t.parameterObservables,this.node=null!=n?n:null,this.boundValues=null!=o?o:[],this.parameterObservables=null!=a?a:[[]]}return e.prototype.getBindings=function(){var e,o,n,a,t,l;for(o={},l=this.node.bindings,n=a=0,t=l.length;t>a;n=++a)e=l[n],o[e]=this.boundValues[n];return R(o)},e.prototype.isEqual=function(e){return null!=e&&this.node===e.node&&F(this.boundValues,e.boundValues)},e.prototype.isRoot=function(){return null==this.node.parent},e.prototype.getParent=function(){var o,n,a,t,l;return null==this.node?null:(o=null!=(t=null!=(l=this.node.parent)?l.bindings.length:void 0)?t:0,n=this.boundValues.slice(0,o),a=this.parameterObservables.slice(0,-1),new e({node:this.node.parent,boundValues:n,parameterObservables:a}))},e.prototype.getChild=function(e){for(var o;null!=e&&!this.isEqual(o=e.getParent());)e=o;return e.parameterObservables=this.parameterObservables.slice(0),e.parameterObservables.push([]),e},e}(),f=function(){function e(e){this.callback=e,I(this.callback)||(this.callback=function(){}),this.dependencies=[],this.initialized=!1}return e.prototype.notify=function(e){var o,n=this;return o=function(){var o,a,t,l;if(!n.initialized)return!0;for(l=n.dependencies,a=0,t=l.length;t>a;a++)if(o=l[a],x(e,o))return!0;return!1}(),o?this.trigger():void 0},e.prototype.trigger=function(){var e,n=this;return this.dependencies=[],e=function(e){return x(n.dependencies,e)||n.dependencies.push(e),o[e]},this.callback(e),this.initialized=!0},e}(),u=new w({node:null}),s={Literal:"Literal",Variable:"Variable"},$=function(e){var o,n,a,t,l,r,i,c;if(e=B(e)?to(e):"",a={},""!==e)for(i=e.split("&"),l=0,r=i.length;r>l;l++)n=i[l],c=n.split("=",2),o=c[0],t=c[1],a[o]=t;return R(a)},S=function(){var e;return"#"+(null!=(e=window.location.href.split("#",2)[1])?e:"")},J=function(e){return B(e)||(e=""),e=to(e),"#"===e.slice(0,1)&&(e=e.slice(1)),window.location.hash=e},R=function(e){var o,n;if(U(e)||(e={}),d.CoerceParameterTypes)for(o in e)n=e[o],"true"===n?n=!0:"false"===n?n=!1:/^[0-9]+$/.test(n)?n=parseInt(n):/^[0-9]+\.[0-9]*$/.test(n)&&(n=parseFloat(n)),e[o]=n;return e},X=function(e){var o;return e=lo(e),o=""===e?[]:e.split("/"),o.unshift("/"),o},G=function(e){var o,n,a,t,l,r,i,c,s;for(l=x(e,"[")||x(e,"]"),l&&function(){var o,n;return n=C(e,"["),1!==n?(n>1&&z.warn('Parsing failed on "'+e+'": Extra ['),1>n&&z.warn('Parsing failed on "'+e+'": Missing ['),null):(o=C(e,"]"),1!==o?(o>1&&z.warn('Parsing failed on "'+e+'": Extra ]'),1>o&&z.warn('Parsing failed on "'+e+'": Missing ]'),null):Y(e,"[")?void 0:(z.warn('Parsing failed on "'+e+'": [ not at beginning'),null))}(),t=e.replace(/[\[\]]/g,""),a=""===t?[]:X(t),c=0,s=a.length;s>c;c++)if(n=a[c],""===n)return z.warn('Parsing failed on "'+e+'": Blank component'),null;if(o=0,l){if(i=e.split("]")[0],r=X(i.replace("[","")),r[r.length-1]!==a[r.length-1])return z.warn('Parsing failed on "'+e+'": ] in the middle of a component'),null;if(r.length===a.length)return z.warn('Parsing failed on "'+e+'": No child components'),null;o=r.length}return new h({components:a,childIndex:o})},E=function(e){return Y(e,":")?s.Variable:s.Literal},L=function(e){switch(E(e)){case s.Literal:return e;case s.Variable:return e.slice(1)}},g=function(e,o,n){var a,t,l,r,i;return l=o.components,t=o.childIndex,r=e,a=[],(i=function(c,u){var d,f,h,b,p,w,m;if(u===t&&(r=c),0>=o.components.length)return c.parent=r,c.bindings=a,c.routeSettings=new v(n);switch(d=l.shift(),h=E(d),f=L(d),h){case s.Literal:b=null!=(w=(p=c.childLiterals)[f])?w:p[f]=new _({name:""+c.name+d+"/",nodeType:h,parent:e});break;case s.Variable:b=null!=(m=c.childVariable)?m:c.childVariable=new _({name:""+c.name+d+"/",nodeType:h,parent:e}),a.push(f)}return i(b,u+1)})(e,0)},O=function(e,o){var n,a,t;return t=X(o),n=[],(a=function(e,o){var t,l;if(0>=o.length&&null!=e.routeSettings)return new w({node:e,boundValues:n});if(t=o[0],null!=e.childLiterals[t]&&(l=a(e.childLiterals[t],o.slice(1)),null!=l))return l;if(null!=e.childVariable){if(n.push(t),l=a(e.childVariable,o.slice(1)),null!=l)return l;n.pop()}return null})(e,t)},y=function(e,o){var n,a,t,l,r;for(a=[],t=o;null!=t;)a.push(t),t=t.getParent();for(t=e;null!=t;){for(l=0,r=a.length;r>l;l++)if(n=a[l],t.isEqual(n))return t;t=t.getParent()}return null},p=n=a=null,b=o=null,l=e=null,r=!1,i=m=!1,c=!1,d={CoerceParameterTypes:!1},(K=function(){return p=new _({name:"*"}),n=u,b={},o={},a=null,l=null,e=null,r=!1,i=!1,m=!1,c=!1})(),Z=function(){var e;return null===a?Q():c?ao():a.isEqual(n)?eo():(e=y(n,a),n.isEqual(e)?oo():no())},oo=function(){var e,o,t,l,r,i,c,s,u,d;return m=!0,l=(null!=(c=null!=(s=n.node)?s.routeSettings:void 0)?c:{context:null}).context,n=n.getChild(a),d=null!=(u=n.node.routeSettings)?u:{},o=d.context,i=d.setup,t=d.load,null==o&&(o={}),o.parent=l,null==i&&(i=function(){}),null==t&&(t=function(){}),e=n.getBindings(),r=function(){return Z()},2===i.length?i.call(o,e,r):(i.call(o,e),r())},eo=function(){var e,o,t,l,r,i,s;return l=function(){return c=!0,a=null,Z()},null==n.node?l():(s=null!=(i=n.node.routeSettings)?i:{},o=s.context,r=s.setup,t=s.load,null==o&&(o={}),null==r&&(r=function(){}),null==t&&(t=function(){}),e=n.getBindings(),2===t.length?t.call(o,e,l):(t.call(o,e),l()))},ao=function(){var e,o,a,t,l,r;return c=!1,a=function(){return Z()},r=null!=(l=n.node.routeSettings)?l:{},o=r.context,t=r.unload,null==o&&(o={}),null==t&&(t=function(){}),e=n.getBindings(),2===t.length?t.call(o,e,a):(t.call(o,e),a())},no=function(){var e,o,a,t,l,r;return m=!1,r=null!=(l=n.node.routeSettings)?l:{},o=r.context,t=r.teardown,null==o&&(o={}),null==t&&(t=function(){}),e=n.getBindings(),a=function(){return n=n.getParent(),Z()},2===t.length?t.call(o,e,a):(t.call(o,e),a())},Q=function(){var e,a,t,l,r,i,c;for(e=D(N(b,o)),b=o,i=n.parameterObservables,c=[],l=0,r=i.length;r>l;l++)t=i[l],c.push(function(){var o,n,l;for(l=[],o=0,n=t.length;n>o;o++)a=t[o],l.push(a.notify(e));return l}());return c},T=function(){var o;return o=S(),Y(o,"#")&&(o=o.slice(1)),o=unescape(o),o!==e?t.call(o)?e=o:J(null!=e?e:""):void 0},t={route:function(e,o){var n,a;return I(o)&&(n=o,o={setup:n},o.load=2===n.length?function(e,o){return m?o():(i=!0,n(e,o))}:function(e){return m?void 0:(i=!0,n(e))}),U(o)||(o={}),B(e)||(e=""),e=to(e),e.length>0||(e="/"),a=G(e),null==a?!1:(g(p,a,o),!0)},call:function(e){var t,l,r,i,c,s;return B(e)||(e="/"),""===e&&(e="/"),s=e.split("?",2),e=s[0],c=s[1],l=O(p,e),null==l?(z.log("FINCH WARNING: Could not find route for: "+e),!1):(i=$(c),t=l.getBindings(),o=q(i,t),null===a&&n.isEqual(l)?Z():(r=a,a=l,null==r&&Z()),!0)},reload:function(){return c?null==n||null==n.node?this:(a=n,Z(),this):this},observe:function(){var e,o,a,l;return e=arguments.length>=1?co.call(arguments,0):[],i?i=!1:(o=e.pop(),I(o)||(o=function(){}),e.length>0?(a=1===e.length&&P(e[0])?e[0]:e,t.observe(function(e){var n,t;return t=function(){var o,t,l;for(l=[],o=0,t=a.length;t>o;o++)n=a[o],l.push(e(n));return l}(),o.apply(null,t)})):(l=new f(o),M(n.parameterObservables).push(l)))},abort:function(){return a=null},listen:function(){return r||("onhashchange"in window&&(I(window.addEventListener)?(window.addEventListener("hashchange",T,!0),r=!0):I(window.attachEvent)&&(window.attachEvent("hashchange",T),r=!0)),r||(l=setInterval(T,33),r=!0),T()),r},ignore:function(){return r&&(null!==l?(clearInterval(l),l=null,r=!1):"onhashchange"in window&&(I(window.removeEventListener)?(window.removeEventListener("hashchange",T,!0),r=!1):I(window.detachEvent)&&(window.detachEvent("hashchange",T),r=!1))),!r},navigate:function(e,o,n){var a,t,l,r,i,c,s,u,d,f,h,b,p;if(b=S().split("?",2),r=b[0],l=b[1],null==r&&(r=""),null==l&&(l=""),"#"===r.slice(0,1)&&(r=r.slice(1)),r=unescape(r),t=$(l),j(o)&&(n=o),U(e)&&(o=e),B(e)||(e=""),U(o)||(o={}),j(n)||(n=!1),e=to(e),0===e.length&&(e=null),n&&(function(){var e,o,n;o={};for(e in t)n=t[e],o[unescape(e)]=unescape(n);return t=o}(),o=q(t,o)),null===e&&(e=r),p=e.split("?",2),e=p[0],d=p[1],"#"===e.slice(0,1)&&(e=e.slice(1)),Y(e,"./")||Y(e,"../")){for(a=r;Y(e,"./")||Y(e,"../");)u=e.indexOf("/"),c=e.slice(0,u),e=e.slice(u+1),".."===c&&(a=a.slice(0,a.lastIndexOf("/")));e=e.length>0?""+a+"/"+e:a}return f=B(d)?$(d):{},o=q(f,o),o=k(o),e=escape(e),s=function(){var e;e=[];for(i in o)h=o[i],e.push(escape(i)+"="+escape(h));return e}().join("&"),s.length>0&&(e+="?"+s),J(e)},reset:function(){t.options({CoerceParameterTypes:!1}),a=u,Z(),t.ignore(),K()},options:function(e){return q(d,e)}},this.Finch=t}).call(this);