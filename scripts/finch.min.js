((function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;k=function(a){return typeof a==typeof {}},j=function(a){return Object.prototype.toString.call(a)==="[object Function]"},i=function(a){return Object.prototype.toString.call(a)==="[object Array]"},l=function(a){return Object.prototype.toString.call(a)==="[object String]"},r=function(a){return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},q=function(a,b){return a.indexOf(b)===0},e=function(a,b){return a.indexOf(b,a.length-b.length)!==-1},f=function(a,b){var c,d;k(a)||(a={}),k(b)||(b={});for(c in b)d=b[c],a[c]=d;return a},b={},p=function(a){var b;return a=l(a)?r(a):"",q(a,"[")&&(b=a.indexOf("]"),b>1?a=a.slice(1,b)+a.slice(b+1):a=a.slice(Math.max(1,b+1))),q(a,"/")&&(a=a.slice(1)),e(a,"/")&&(a=a.slice(0,a.length-1)),a},h=function(a){var b,c;return a=l(a)?r(a):"",c=null,q(a,"[")&&(b=a.indexOf("]"),b>1&&(c=a.slice(1,b))),c},g=function(a,b){var c,d,e,f,g;l(b)||(b=""),l(a)||(a=""),b=p(b),a=p(a),g=b.split("/"),f=a.split("/");if(g.length!==f.length)return{};d={};for(c in f)e=f[c],q(e,":")&&(d[e.slice(1)]=g[c]);return d},n=function(a){var b,c,d,e,f,g,h,i;a=l(a)?r(a):"",d={},h=a.split("&");for(f=0,g=h.length;f<g;f++)c=h[f],i=c.split("=",2),b=i[0],e=i[1],d[b]=e;return d},m=function(a,b){var c,d,e,f;a=p(a),b=p(b),f=a.split("/"),e=b.split("/");if(f.length!==e.length)return!1;for(c in e){d=e[c];if(d!==f[c]&&!q(d,":"))return!1}return!0},c=function(a){var c,d;return a=p(a),c=[],(d=function(a){a=b[a];if(k(a)){j(a.setup)&&c.unshift(a);if(a.parentPattern!=null&&a.parentPattern!=="")return d(a.parentPattern)}})(a),c},o=function(a,b){var c;i(a)||(a=[]),k(b)||(b={}),(c=function(a,b){var d,e;if(a.length<=0)return;return d=a.shift(),k(d)||(d={}),j(d.setup)||(e=function(){}),d.setup.length===2?d.setup(b,function(d){return k(d)||(d={}),f(b,d),c.call(c,a,b)}):(d.setup(b),c(a,b))})(a,b)},d=function(a,c){var d,f,g;return a=p(a),c=p(c),f=c.split("/"),g=[],f.length<=0?g:((d=function(a){var h,i,j,k,l,m,n;l=a.split("/"),i="",j=!0,n=0;while(j&&l.length>n&&f.length>n)k=l[n],m=f[n],q(k,":")||k===m?i+=""+m+"/":j=!1,n++;e(i,"/")&&(i=i.slice(0,-1)),h=b[a];if(i!==""){g.unshift(i);if(h.parentPattern!=null&&h.parentPattern!=="")return d(h.parentPattern,c)}})(a),g)},a={route:function(a,c){var d;return l(a)||(a=""),j(c)||(c=function(){}),d=h(a),a=p(a),d=p(d),b[a]={context:{},pattern:a,parentPattern:d,setup:c,teardown:function(){}}},call:function(a,e){var h,i,q,r,s,t,u;l(a)||(a=""),k(e)||(e={}),u=a.split("?",2),t=u[0],s=u[1],t=p(t),r=n(s),f(e,r);if(j(b[t]))return b[t](e);for(q in b){i=b[q];if(m(t,q))return f(e,g(q,t)),h=c(q),console.log(d(q,t)),o(h,e),!0}return!1}},this.Finch=a})).call(this);