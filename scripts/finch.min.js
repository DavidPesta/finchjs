((function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y;p=function(a){return typeof a==typeof {}},n=function(a){return Object.prototype.toString.call(a)==="[object Function]"},m=function(a){return Object.prototype.toString.call(a)==="[object Array]"},q=function(a){return Object.prototype.toString.call(a)==="[object String]"},o=function(a){return Object.prototype.toString.call(a)==="[object Number]"},x=function(a){return a.replace(/^\s+/,"").replace(/\s+$/,"")},y=function(a){return a.replace(/^\/+/,"").replace(/\/+$/,"")},w=function(a,b){return a.indexOf(b)===0},h=function(a,b){return a.indexOf(b,a.length-b.length)!==-1},i=function(a,b){var c,d;p(a)||(a={}),p(b)||(b={});for(c in b)d=b[c],a[c]=d;return a},b={},g=[],f=[],e=null,v=function(a){var b;return a=q(a)?x(a):"",w(a,"[")&&(b=a.indexOf("]"),b>1?a=a.slice(1,b)+a.slice(b+1):a=a.slice(Math.max(1,b+1))),a=y(a),a},l=function(a){var b,c;return a=q(a)?x(a):"",c=null,w(a,"[")&&(b=a.indexOf("]"),b>1&&(c=a.slice(1,b))),c},k=function(a,b){var c,d,e,f,g;q(b)||(b=""),q(a)||(a=""),b=v(b),a=v(a),g=b.split("/"),f=a.split("/");if(g.length!==f.length)return{};d={};for(c in f)e=f[c],w(e,":")&&(d[e.slice(1)]=g[c]);return d},s=function(a){var b,c,d,e,f,g,h,i;a=q(a)?x(a):"",d={},h=a.split("&");for(f=0,g=h.length;f<g;f++)c=h[f],i=c.split("=",2),b=i[0],e=i[1],d[b]=e;return d},r=function(a,b){var c,d,e,f;a=v(a),b=v(b),f=a.split("/"),e=b.split("/");if(f.length!==e.length)return!1;for(c in e){d=e[c];if(d!==f[c]&&!w(d,":"))return!1}return!0},c=function(a){var c,d;return a=v(a),c=[],(d=function(a){var e;e=b[a];if(p(e)){n(e.setup)&&c.unshift(e);if(e.parentPattern!=null&&e.parentPattern!=="")return d(e.parentPattern)}})(a),c},t=function(a,b,c,d){var h,j,k;m(a)||(a=[]),m(b)||(b=[]),c=o(c)&&c>0?parseInt(c):0,p(d)||(d={}),h=!1,j=function(){},e={abort:function(a){return n(a)||(a=function(){}),j=function(){return e=null,a()},h=!0}};if(a.length<=c)return;a=a.slice(c),b=b.slice(c),(k=function(a,b,c){var d,l;return a.length<=0?e=null:h?j():(d=a.shift(),l=b.shift(),p(d)||(d={}),q(l)||(l=""),n(d.setup)||(d.setup=function(){}),d.setup.length===2?d.setup(c,function(e){return f.push(d),g.push(l),p(e)||(e={}),i(c,e),k.call(k,a,b,c)}):(d.setup(c),f.push(d),g.push(l),k(a,b,c)))})(a,b,d)},u=function(a,b,c){var d;m(a)||(a=[]),m(b)||(b=[]),c=o(c)&&c>0?parseInt(c):0;if(a.length<=c)return;(d=function(a,b){var e,f;if(a.length<=c)return;return e=a.pop(),f=b.pop(),p(e)||(e={}),q(f)||(f=""),n(e.teardown)||(e.teardown=function(){}),e.teardown(),d(a,b)})(a,b)},j=function(a,b){var c;m(a)||(a=[]),m(b)||(b=[]),c=0;while(a.length>c&&b.length>c){if(a[c]!==b[c])break;c++}return c},d=function(a,c){var d,e,f;return a=v(a),c=v(c),e=c.split("/"),f=[],e.length<=0?f:((d=function(a){var g,i,j,k,l,m,n;l=a.split("/"),i="",j=!0,n=0;while(j&&l.length>n&&e.length>n)k=l[n],m=e[n],w(k,":")||k===m?i+=""+m+"/":j=!1,n++;h(i,"/")&&(i=i.slice(0,-1)),g=b[a];if(i!==""){f.unshift(i);if(g.parentPattern!=null&&g.parentPattern!=="")return d(g.parentPattern,c)}})(a),f)},a={route:function(a,c){var d;return q(a)||(a=""),n(c)||(c=function(){}),d=l(a),a=v(a),d=v(d),b[a]={context:{},pattern:a,parentPattern:d,setup:c,teardown:function(){}}},call:function(h,l){var m,o,w,x,y,z,A,B,C;q(h)||(h=""),p(l)||(l={}),C=h.split("?",2),z=C[0],y=C[1],z=v(z),x=s(y),i(l,x);if(n(b[z]))return b[z](l);for(w in b){o=b[w];if(r(z,w))return e!=null?e.abort(function(){return a.call(h,l)}):(i(l,k(w,z)),m=c(w),A=d(w,z),B=j(g,A),u(f,g,B),t(m,A,B,l),!0)}return!1}},this.Finch=a})).call(this);